---
globs: packages/ai-flows/**/*.ts
alwaysApply: false
---

@listforge-base.mdc

# Purpose

- Define AI workflows as composable graphs & tools:
  - e.g., `photo-intake-v1`, `price-refresh-v1`.
- Encodes the logic: vision → normalize → research → pricing → generation → validation.
- Orchestrates AI-powered listing generation workflows.

# Separation of Concerns

- Keep flows as orchestrators; do not embed heavy DB logic.
- Use tools or callbacks to do side effects (e.g., fetch comps, write to DB).
- Make flows testable with mocked tools.
- Flows should be pure orchestration logic.

# Workflow Patterns

- Use LangGraph or LangChain for workflow definition.
- Define nodes as discrete steps in the workflow.
- Use edges to define flow control and decision points.
- Support conditional branching based on AI outputs.

# Tool Integration

- Tools handle external operations:
  - Database reads/writes
  - Marketplace API calls
  - Image processing
  - Price research
- Tools are injected into workflows, not defined within them.

# Versioning

- Use versioned workflow names (e.g., `photo-intake-v1`, `photo-intake-v2`).
- Support multiple workflow versions simultaneously.
- Document workflow changes and migration paths.

# Testing

- Test workflows with mocked tools.
- Verify workflow logic independently of external services.
- Use deterministic test fixtures for AI outputs.

# Error Handling

- Handle AI API failures gracefully.
- Provide fallback behaviors when AI services are unavailable.
- Log workflow execution for debugging.
