# ============================================
# ListForge API - Environment Variables
# ============================================
# Copy this file to .env and fill in your values
# Never commit .env to version control

# ============================================
# Application Configuration
# ============================================

# Port the API server will listen on
PORT=3001

# Node environment (development, production, test)
NODE_ENV=development

# Frontend URL for CORS and OAuth redirects
# Can be a single URL or comma-separated list
FRONTEND_URL=http://localhost:3000,http://localhost:5173

# ============================================
# Database Configuration (PostgreSQL)
# ============================================

# Option 1: Use a full database URL (recommended for production)
# Format: postgresql://user:password@host:5432/database
# DATABASE_URL=postgresql://user:password@host:5432/database

# Option 2: Use individual connection parameters (for development)
DB_HOST=localhost
DB_PORT=5432
DB_USER=listforge
DB_PASSWORD=listforge
DB_NAME=listforge_dev

# SSL configuration (for production databases like Supabase)
# DB_SSL=true
# DB_SSL_REJECT_UNAUTHORIZED=false

# ============================================
# Redis Configuration
# ============================================

# Option 1: Use a full Redis URL (recommended for production)
# Format: redis://[password@]host:port[/db]
# REDIS_URL=redis://localhost:6379

# Option 2: Use individual connection parameters (for development)
REDIS_HOST=localhost
REDIS_PORT=6379
# REDIS_PASSWORD=
# REDIS_DB=0

# ============================================
# Authentication & Security
# ============================================

# JWT secret key for signing tokens (CHANGE IN PRODUCTION!)
# Generate a strong random string: openssl rand -base64 32
JWT_SECRET=dev-secret-change-in-production

# JWT token expiration time (e.g., 7d, 24h, 1h)
JWT_EXPIRES_IN=7d

# Secret key for encrypting OAuth state parameters
# Generate a strong random string: openssl rand -base64 32
OAUTH_STATE_SECRET=dev-oauth-state-secret-change-in-production

# ============================================
# ENCRYPTION KEY - CRITICAL SECURITY SETTING
# ============================================
#
# ⚠️  CRITICAL: This key encrypts marketplace OAuth tokens (eBay, Amazon, etc.)
# ⚠️  PRODUCTION REQUIREMENT: You MUST change this before deploying to production
# ⚠️  NEVER commit your production key to version control
#
# Requirements:
# - Must be exactly 64 hexadecimal characters (256 bits for AES-256)
# - Must be cryptographically random (do NOT use simple patterns)
# - The default value below (all zeros) is INSECURE and for development only
#
# Generate a secure key:
#   openssl rand -hex 32
#
# Security Notes:
# - The application will REFUSE to start in production with the default key
# - If this key is leaked, all stored marketplace tokens are compromised
# - Rotating this key requires re-encrypting all existing tokens (see below)
# - Store production keys in a secure secrets management system
#
# ⚠️  DO NOT USE THIS DEFAULT VALUE IN PRODUCTION ⚠️
ENCRYPTION_KEY=00000000000000000000000000000000

# ============================================
# ENCRYPTION KEY ROTATION (Advanced)
# ============================================
#
# The system supports key versioning for secure encryption key rotation.
# This allows you to rotate keys without service downtime or data loss.
#
# Key Versioning:
# - ENCRYPTION_KEY (or ENCRYPTION_KEY_V1): Primary/legacy key version 1
# - ENCRYPTION_KEY_V2: New key version 2
# - ENCRYPTION_KEY_V3: New key version 3 (and so on)
#
# How Encryption Works:
# - New tokens are encrypted with the LATEST version available
# - Old tokens can still be decrypted using their original version
# - Format: "v2:encrypted_data" (version prefix added automatically)
# - Backward compatible: No prefix = version 1 (legacy data)
#
# When to Rotate:
# - Suspected key compromise or security breach
# - Compliance requirements (e.g., annual rotation policy)
# - Employee/vendor with key access leaves organization
# - Proactive security measure (recommended annually)
#
# Rotation Workflow:
# 1. Generate new key: openssl rand -hex 32
# 2. Add to .env as ENCRYPTION_KEY_V2 (keep V1 for now)
# 3. Restart application to load new key
# 4. Preview changes: npm run cli:rotate-keys --dry-run
# 5. Execute rotation: npm run cli:rotate-keys
# 6. Verify application works correctly with new key
# 7. Monitor for 30 days to ensure stability
# 8. Remove old ENCRYPTION_KEY_V1 from .env
# 9. Restart application (old key no longer needed)
#
# CLI Command Options:
#   npm run cli:rotate-keys --dry-run           # Preview without changes
#   npm run cli:rotate-keys                     # Rotate to latest version
#   npm run cli:rotate-keys --version 2         # Rotate to specific version
#   npm run cli:rotate-keys --only 1            # Only rotate v1 accounts
#   npm run cli:rotate-keys --help              # Show full help
#
# Safety Features:
# - Dry-run mode to preview changes before execution
# - Batch processing to avoid database overload
# - Individual failures don't stop the operation
# - Can be safely re-run if interrupted
# - Full statistics and error reporting
#
# Example Multi-Version Setup:
# ENCRYPTION_KEY_V1=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
# ENCRYPTION_KEY_V2=fedcba9876543210fedcba9876543210fedcba9876543210fedcba9876543210
#
# Notes:
# - Keep old keys available during migration period
# - Test rotation in staging environment first
# - Database backup recommended before rotation
# - Monitor logs during and after rotation
#
# ⚠️  IMPORTANT: Old keys must remain until all data is re-encrypted ⚠️

# ============================================
# Storage Configuration
# ============================================

# Storage provider: 's3' (default: s3)
# - 's3': AWS S3 or MinIO (for local development)
STORAGE_PROVIDER=s3

# AWS S3 / MinIO Configuration (when STORAGE_PROVIDER=s3)
# Bucket name for file uploads
S3_BUCKET=listforge-uploads

# AWS region (defaults to AWS_REGION if set)
S3_REGION=us-east-1

# For LOCAL DEVELOPMENT with MinIO (docker-compose):
# Uncomment these lines and set S3_ENDPOINT to use MinIO
# S3_ENDPOINT=http://localhost:9000
# S3_ACCESS_KEY_ID=minioadmin
# S3_SECRET_ACCESS_KEY=minioadmin

# For PRODUCTION with AWS S3:
# Leave S3_ENDPOINT, S3_ACCESS_KEY_ID, and S3_SECRET_ACCESS_KEY unset
# AWS credentials are automatically detected from:
# - IAM role (when running on AWS)
# - AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY env vars
# - ~/.aws/credentials file


# ============================================
# AI/OpenAI Configuration
# ============================================

# OpenAI API key for AI workflow processing
# Get from: https://platform.openai.com/api-keys
# Used for: AI chat, image analysis (OCR), web search, and research workflows
OPENAI_API_KEY=

# OpenAI model to use (optional, defaults to gpt-4o)
# OPENAI_MODEL=gpt-4o

# ============================================
# Amazon Research & Pricing Data
# ============================================

# Keepa API - Historical Amazon pricing and sales data
# Get from: https://keepa.com/#!api (requires paid subscription)
# Provides: Price history, sales rank trends, UPC to ASIN lookups
KEEPA_API_KEY=

# Amazon SP-API - Current product catalog and real-time data
# Get from: https://sellercentral.amazon.com/ > Apps & Services > Develop Apps
# More complex to set up - see docs/AMAZON_SETUP.md (if available)
# Note: Keepa alone is sufficient for most use cases

# Amazon OAuth Client Credentials
AMAZON_CLIENT_ID=
AMAZON_CLIENT_SECRET=

# Amazon OAuth Tokens (obtained through OAuth flow)
AMAZON_ACCESS_TOKEN=
AMAZON_REFRESH_TOKEN=

# Amazon Region (NA, EU, or FE)
# NA = North America, EU = Europe, FE = Far East
AMAZON_REGION=NA

# Amazon Marketplace ID
# US: ATVPDKIKX0DER, CA: A2EUQ1WTGCTBG2, UK: A1F83G8C2ARO7P, etc.
AMAZON_MARKETPLACE_ID=ATVPDKIKX0DER

# ============================================
# UPC/EAN Barcode Lookup
# ============================================

# UPC Database API - Product lookup by barcode
# Get from: https://www.upcitemdb.com/
# Optional: If not provided, uses trial API with rate limits
UPC_DATABASE_API_KEY=

# ============================================
# eBay Marketplace Configuration
# ============================================

# eBay Application ID (App ID)
# Get from: https://developer.ebay.com/my/keys
EBAY_APP_ID=

# eBay Certificate ID (Client Secret)
EBAY_CERT_ID=

# eBay Developer ID (optional, for some API features)
# EBAY_DEV_ID=

# Use eBay Sandbox environment (true/false)
# Set to true for testing, false for production
EBAY_SANDBOX=true

# eBay OAuth redirect URI (optional, defaults to FRONTEND_URL + /settings/marketplaces/ebay/callback)
# EBAY_REDIRECT_URI=http://localhost:3000/settings/marketplaces/ebay/callback

# ============================================
# eBay Webhook Configuration
# ============================================

# Secret for verifying eBay webhook signatures
# Generate a strong random string: openssl rand -base64 32
EBAY_WEBHOOK_SECRET=

# Verification token for eBay webhook challenge
# Set this in your eBay developer console webhook settings
EBAY_VERIFICATION_TOKEN=

# Public endpoint URL where eBay webhooks will be sent
# Must be publicly accessible (use ngrok or similar for local dev)
# EBAY_WEBHOOK_ENDPOINT=https://your-domain.com/api/marketplaces/webhooks/ebay

# ============================================
# Logging & Monitoring (Optional)
# ============================================

# Enable detailed logging (true/false)
# LOG_LEVEL=debug

# Sentry DSN for error tracking (optional)
# SENTRY_DSN=

